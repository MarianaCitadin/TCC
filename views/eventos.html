<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/paginas/eventos.css">
    <title>Tela de Eventos - Clicando na Terceira Idade</title>
    <script src="/js/paginas/eventos.js" defer></script>
</head>
<body>
    <header>
        <div class="logo">Clicando na Terceira Idade</div>
        <nav>
            <ul>
                <li><a href="index">Início</a></li>
                <li><a href="fotos">Fotos</a></li>
                <li><a href="turma">Turmas</a></li>
                <li><a href="usuario">Usuários</a></li>
                <li><a href="materiais">Materiais</a></li>
                <li><a href="sobre">Sobre Nós</a></li>
                <li><a href="/">Sair</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <h1>Eventos</h1>
        <!-- Filtro de eventos -->
        <form id="filterForm" class="filter-form">
            <input type="text" id="searchTerm" placeholder="Pesquisar por título" class="filter-input">
            <input type="date" id="searchDate" class="filter-input">
        </form>

        <div id="eventosContainer"></div> <!-- Aqui os eventos serão carregados -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Função para carregar eventos do backend
            function carregarEventos(filtro = {}) {
                fetch('/api/eventos')  // Chama a rota que retorna os eventos
                    .then(response => response.json())
                    .then(data => {
                        const eventosContainer = document.getElementById('eventosContainer');
                        eventosContainer.innerHTML = '';  // Limpa qualquer conteúdo existente

                        // Filtra os eventos conforme os critérios fornecidos
                        const eventosFiltrados = data.eventos.filter(evento => {
                            const titulo = evento.NomeEvento.toLowerCase();
                            const dataEvento = new Date(evento.DataEvento).toLocaleDateString('pt-BR');

                            // Verifica se o título contém o termo de pesquisa
                            const matchesTitle = titulo.includes(filtro.title?.toLowerCase() || '');
                            const matchesDate = filtro.date ? dataEvento.includes(filtro.date) : true;

                            return matchesTitle && matchesDate;
                        });

                        // Verifica se existem eventos após o filtro
                        if (eventosFiltrados.length > 0) {
                            eventosFiltrados.forEach(evento => {
                                // Cria o HTML para cada evento
                                const eventoDiv = document.createElement('div');
                                eventoDiv.classList.add('event');
                                
                                const eventHeader = document.createElement('div');
                                eventHeader.classList.add('event-header');

                                const eventDate = document.createElement('p');
                                eventDate.classList.add('event-date');
                                eventDate.textContent = new Date(evento.DataEvento).toLocaleDateString('pt-BR');  // Formata a data

                                const eventTitle = document.createElement('p');
                                eventTitle.classList.add('event-title');
                                eventTitle.textContent = evento.NomeEvento;

                                const eventDescription = document.createElement('p');
                                eventDescription.classList.add('event-description');
                                eventDescription.textContent = evento.Descricao || 'Sem descrição disponível';  // Descrição pode ser nula

                                // Adiciona o conteúdo aos elementos
                                eventHeader.appendChild(eventDate);
                                eventHeader.appendChild(eventTitle);
                                eventoDiv.appendChild(eventHeader);
                                eventoDiv.appendChild(eventDescription);
                                eventosContainer.appendChild(eventoDiv);
                            });
                        } else {
                            eventosContainer.innerHTML = '<p>Nenhum evento encontrado.</p>';
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao carregar eventos:', error);
                    });
            }

            // Função de filtro
            function aplicarFiltro() {
                const searchTerm = document.getElementById('searchTerm').value;
                const searchDate = document.getElementById('searchDate').value;

                carregarEventos({ title: searchTerm, date: searchDate });
            }

            // Carrega os eventos ao carregar a página
            carregarEventos();

            // Adiciona evento de input para o filtro
            document.getElementById('filterForm').addEventListener('input', aplicarFiltro);
        });
    </script>
</body>
</html>
